# Angebots-CPQ System - Konzept v1.0

**Datum:** 2026-01-30
**Status:** In Planung
**Autor:** Claude + Holger Neumann

---

## 1. Ãœbersicht

Ein CPQ-System (Configure-Price-Quote) fÃ¼r Komplettsanierung, das aus Spracheingaben, Transkriptionen und Katalogsuche automatisch strukturierte Angebote generiert.

### Kernfeatures

| Feature | MVP | Phase 2 | Phase 3 |
|---------|-----|---------|---------|
| Wizard-basierte Angebotserstellung | âœ… | | |
| Gewerk-basierte Struktur | âœ… | | |
| LV-Position-Suche (Text + Semantik) | âœ… | | |
| Spracheingabe (Whisper) | âœ… | | |
| Transkription-Parsing | âœ… | | |
| Regelbasierte AbhÃ¤ngigkeiten | âœ… | | |
| LV-Langtext-Analyse (semantisch) | âœ… | | |
| AufmaÃŸ-Integration (CSV) | âœ… | | |
| Mengen-Zuweisung aus AufmaÃŸ | âœ… | | |
| Margin-Profile & ZuschlÃ¤ge | âœ… | | |
| PDF-Generierung | âœ… | | |
| 4-Augen-Freigabe | âœ… | | |
| E-Mail-Versand | âœ… | | |
| Raum-basierte Struktur | | âœ… | |
| Kundenspezifisches Training | | âœ… | |
| Rechnungs-basiertes Lernen | | | âœ… |
| Matterport API Integration | | | âœ… |
| GAEB Import/Export | | | âœ… |

---

## 2. Bestehende Infrastruktur (nutzen!)

### 2.1 Datenbanktabellen

| Tabelle | Zweck | DatensÃ¤tze |
|---------|-------|------------|
| `lv_positionen` | Positionskatalog mit Embeddings | 3.167 |
| `aufmass_data` | AufmaÃŸe pro ATBS (rooms JSONB) | variabel |
| `matterport_spaces` | 3D-Scans verknÃ¼pft mit ATBS | 25 |
| `monday_bauprozess` | Projekte (ATBS, Kunde, Adresse) | 193 |
| `kontakte` | Kunden, NUs, Lieferanten | 1.379 |

### 2.2 Edge Functions

| Function | Zweck | Wiederverwendbar |
|----------|-------|------------------|
| `telegram-webhook` | Spracheâ†’Text (Whisper), CSV-Import | Whisper-Integration |
| `process-aufmass-complete` | CSVâ†’Excel+JSON | AufmaÃŸ-Parsing |
| `search-lv` | Embedding-basierte Suche | Positionssuche |

### 2.3 UI-Komponenten

| Komponente | Pfad | Wiederverwendbar |
|------------|------|------------------|
| PDF-Generator | `ui/src/routes/lv-export/+page.svelte` | jsPDF + autotable |
| LV-Suche | `ui/src/routes/einkauf/+page.svelte` | Text + KI-Suche |

---

## 3. Wizard-Flow (6 Schritte)

### Schritt 0: Projekt auswÃ¤hlen (Kontext)

**Ausgangspunkt:** User ist bereits im Bauvorhaben (ATBS-Nummer bekannt)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ Neues Angebot erstellen                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Projekt: ATBS-472 | VBW | Bollwerkstr. 9, 44263 Dortmund      â”‚
â”‚  Kunde: VBW Bauen und Wohnen GmbH                               â”‚
â”‚                                                                 â”‚
â”‚  Struktur:                                                      â”‚
â”‚  â—‹ Nach Gewerken (Standard)                                     â”‚
â”‚  â—‹ Nach RÃ¤umen (benÃ¶tigt AufmaÃŸ)                                â”‚
â”‚                                                                 â”‚
â”‚  AufmaÃŸ:                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â—‹ Bestehendes AufmaÃŸ verwenden                              â”‚â”‚
â”‚  â”‚   [ATBS-472 - 65,4 mÂ² Netto, 7 RÃ¤ume â–¼]                     â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ â—‹ Neues AufmaÃŸ hochladen (Matterport CSV)                   â”‚â”‚
â”‚  â”‚   [ğŸ“ CSV-Datei auswÃ¤hlen...]                               â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ â—‹ Manuelles AufmaÃŸ eingeben                                 â”‚â”‚
â”‚  â”‚   [RÃ¤ume hinzufÃ¼gen â†’]                                      â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ â—‹ Ohne AufmaÃŸ (Mengen spÃ¤ter manuell)                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  [Weiter â†’]                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**CSV-Import Dialog (bei "Neues AufmaÃŸ hochladen"):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¤ Matterport CSV importieren                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  [â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•] Datei: ATBS-472_Aufmass.csv     â”‚
â”‚                                                                 â”‚
â”‚  Erkannte RÃ¤ume:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Raum             â”‚ Netto mÂ² â”‚ Brutto mÂ²â”‚ HÃ¶he m   â”‚         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚  â”‚ Wohnzimmer       â”‚   23,5   â”‚   25,0   â”‚   2,70   â”‚         â”‚
â”‚  â”‚ Schlafzimmer     â”‚   15,2   â”‚   16,8   â”‚   2,70   â”‚         â”‚
â”‚  â”‚ KÃ¼che            â”‚   12,0   â”‚   13,5   â”‚   2,70   â”‚         â”‚
â”‚  â”‚ Bad              â”‚    6,5   â”‚    7,2   â”‚   2,50   â”‚         â”‚
â”‚  â”‚ Flur             â”‚    8,2   â”‚   10,0   â”‚   2,70   â”‚         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚  â”‚ GESAMT           â”‚   65,4   â”‚   72,5   â”‚          â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                 â”‚
â”‚  â˜‘ WandflÃ¤chen automatisch berechnen (Umfang Ã— HÃ¶he)           â”‚
â”‚  â˜‘ AufmaÃŸ fÃ¼r ATBS-472 speichern                               â”‚
â”‚                                                                 â”‚
â”‚  [Abbrechen]                            [Importieren & Weiter â†’]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Raum-Detail bearbeiten (Geometrie + TeilflÃ¤chen):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ Raum: Wohnzimmer                                    [Ã— âœ“]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Grunddaten                 â”‚  TeilflÃ¤chen (bei L/U-Form)  â”‚â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚â”‚
â”‚  â”‚                             â”‚                               â”‚â”‚
â”‚  â”‚  Raumtyp: [Rechteck â–¼]      â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”     â”‚â”‚
â”‚  â”‚           â—‹ Rechteck        â”‚  â”‚ Teilâ”‚ L Ã— B â”‚  mÂ²   â”‚     â”‚â”‚
â”‚  â”‚           â—‹ L-Form          â”‚  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚â”‚
â”‚  â”‚           â—‹ U-Form          â”‚  â”‚  A  â”‚ 4,5Ã—3 â”‚ 13,5  â”‚     â”‚â”‚
â”‚  â”‚                             â”‚  â”‚  B  â”‚ 3,0Ã—2 â”‚  6,0  â”‚     â”‚â”‚
â”‚  â”‚  HÃ¶he: [2,70] m             â”‚  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚â”‚
â”‚  â”‚                             â”‚  â”‚ Î£   â”‚       â”‚ 19,5  â”‚     â”‚â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚â”‚
â”‚  â”‚                             â”‚                               â”‚â”‚
â”‚  â”‚  Bei Rechteck:              â”‚  Gemeinsame WÃ¤nde:            â”‚â”‚
â”‚  â”‚  LÃ¤nge: [5,50] m            â”‚  (InnenwÃ¤nde zw. TeilflÃ¤chen) â”‚â”‚
â”‚  â”‚  Breite: [4,20] m           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚â”‚
â”‚  â”‚                             â”‚  â”‚ Aâ†”B: [3,0] m        â”‚     â”‚â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚ (wird 1Ã— abgezogen) â”‚     â”‚â”‚
â”‚  â”‚                             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚â”‚
â”‚  â”‚  Netto: 23,1 mÂ² (berechnet) â”‚                               â”‚â”‚
â”‚  â”‚  WandflÃ¤che: 52,4 mÂ²        â”‚  AbzÃ¼ge (TÃ¼ren/Fenster):      â”‚â”‚
â”‚  â”‚  Umfang: 19,4 lfm           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚â”‚
â”‚  â”‚                             â”‚  â”‚ TÃ¼r:    [1] Ã— 2,0 mÂ²â”‚     â”‚â”‚
â”‚  â”‚                             â”‚  â”‚ Fenster:[1] Ã— 1,5 mÂ²â”‚     â”‚â”‚
â”‚  â”‚                             â”‚  â”‚ = -3,5 mÂ² WandflÃ¤cheâ”‚     â”‚â”‚
â”‚  â”‚                             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  Ergebnis:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  GrundflÃ¤che:  23,1 mÂ²                                      â”‚â”‚
â”‚  â”‚  WandflÃ¤che:   52,4 mÂ² - 3,5 mÂ² (AbzÃ¼ge) = 48,9 mÂ²         â”‚â”‚
â”‚  â”‚  DeckenflÃ¤che: 23,1 mÂ²                                      â”‚â”‚
â”‚  â”‚  Umfang:       19,4 lfm                                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  [Abbrechen]                                    [Speichern âœ“]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Raumtypen und Berechnungslogik:**

| Typ | Eingabe | Berechnung WandflÃ¤che |
|-----|---------|----------------------|
| **Rechteck** | L Ã— B Ã— H | (L+B) Ã— 2 Ã— H |
| **L-Form** | Teil A (LÃ—B) + Teil B (LÃ—B) + H + gemeinsame Wand | AuÃŸenumfang Ã— H (gemeinsame Wand 1Ã— abziehen) |
| **U-Form** | Teil A + B + C + H + 2 gemeinsame WÃ¤nde | AuÃŸenumfang Ã— H (gemeinsame WÃ¤nde abziehen) |

**Beispiel L-Form Berechnung:**
```
Teil A: 4,5 Ã— 3,0 = 13,5 mÂ²
Teil B: 3,0 Ã— 2,0 =  6,0 mÂ²
GrundflÃ¤che: 19,5 mÂ²

AuÃŸenumfang L-Form: 4,5 + 3,0 + 1,5 + 2,0 + 3,0 + 5,0 = 19,0 lfm
(Teil A: 4,5+3 | Knick: 1,5+2 | Teil B: 3+5)

Gemeinsame Wand Aâ†”B: 3,0 m (nur 1Ã— in Umfang, nicht 2Ã—)

WandflÃ¤che: 19,0 Ã— 2,70 = 51,3 mÂ²
```

**Datenquellen:**
- `monday_bauprozess` â†’ Projekt, Kunde, Adresse
- `aufmass_data` â†’ RÃ¤ume, FlÃ¤chen (falls vorhanden)
- `lv_positionen` â†’ Gewerke fÃ¼r Struktur
- CSV-Import â†’ Gleiche Logik wie `process-aufmass-complete` Edge Function

---

### Schritt 1: Positionen erstellen (KI-gestÃ¼tzt)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ Positionen hinzufÃ¼gen                           ATBS-472    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Eingabe-Methoden:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ¤ [Spracheingabe starten]                                  â”‚â”‚
â”‚  â”‚    "Wohnzimmer WÃ¤nde Raufaser Q2 mit Streichen"             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ“„ [Transkription hochladen] (.txt, .docx)                  â”‚â”‚
â”‚  â”‚    Baubesprechung, Plaud-Export, etc.                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ” Katalogsuche: [___________________________] [Suchen]     â”‚â”‚
â”‚  â”‚    Text oder semantische Suche in lv_positionen             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Erkannte Positionen:                                           â”‚
â”‚                                                                 â”‚
â”‚  â–¼ Maler (4 Positionen)                                         â”‚
â”‚    â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚    â”‚ â­ â”‚ Position                           â”‚ Einheitâ”‚   VK   â”‚â”‚
â”‚    â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚    â”‚ â˜… â”‚ Raufaser tapezieren                â”‚ mÂ²     â”‚  8,50 â‚¬â”‚â”‚
â”‚    â”‚   â”‚ GWS.LV23-05.01.1                   â”‚        â”‚        â”‚â”‚
â”‚    â”‚   â”‚ â”œâ”€ ğŸ”— Untergrund vorbereiten       â”‚ mÂ²     â”‚  3,20 â‚¬â”‚â”‚
â”‚    â”‚   â”‚ â”œâ”€ ğŸ”— Q2 Ausbesserung (25%)        â”‚ mÂ²     â”‚  4,80 â‚¬â”‚â”‚
â”‚    â”‚   â”‚ â””â”€ ğŸ”— Streichen 2x Dispersionsfarbeâ”‚ mÂ²     â”‚  6,40 â‚¬â”‚â”‚
â”‚    â”‚ â˜† â”‚ Decke streichen                    â”‚ mÂ²     â”‚  5,90 â‚¬â”‚â”‚
â”‚    â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  ğŸ’¡ Weitere VorschlÃ¤ge (basierend auf AbhÃ¤ngigkeiten):          â”‚
â”‚    [+ Abkleben/Abdecken] [+ Sockelleisten lackieren]            â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ğŸ“ Optionale Bedarfspositionen (nach Demontage):               â”‚
â”‚    [+ Schimmelbehandlung] [+ Putzausbesserung] [+ Elektroschlitze]â”‚
â”‚                                                                 â”‚
â”‚  [â† ZurÃ¼ck]                              [Weiter: Mengen â†’]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Features:**
- â­ Favoriten-Sterne (hÃ¶her priorisiert in Suche)
- ğŸ”— Automatische AbhÃ¤ngigkeits-VorschlÃ¤ge
- Optionale Bedarfspositionen am Ende

---

### Schritt 2: Mengen zuweisen (AufmaÃŸ-basiert)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ Mengen zuweisen                                 ATBS-472    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Position 1/12: Raufaser tapezieren [Wand]                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                     â”‚   WandflÃ¤che â”‚ GrundflÃ¤che â”‚  Umfang  â”‚â”‚
â”‚  â”‚  Raum               â”‚      mÂ²      â”‚     mÂ²      â”‚   lfm    â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ â˜‘ Wohnzimmer        â”‚    42,5      â”‚    18,2     â”‚   17,4   â”‚â”‚
â”‚  â”‚ â˜‘ Schlafzimmer      â”‚    38,0      â”‚    15,0     â”‚   15,5   â”‚â”‚
â”‚  â”‚ â˜‘ KÃ¼che             â”‚    28,5      â”‚    12,0     â”‚   14,0   â”‚â”‚
â”‚  â”‚ â˜‘ Flur              â”‚    22,0      â”‚     8,5     â”‚   11,2   â”‚â”‚
â”‚  â”‚ â˜ Bad (Pauschal)    â”‚    18,0      â”‚     6,5     â”‚   10,2   â”‚â”‚
â”‚  â”‚ â˜ WC                â”‚     8,5      â”‚     3,2     â”‚    7,4   â”‚â”‚
â”‚  â”‚ â˜‘ Abstellraum       â”‚    12,0      â”‚     4,0     â”‚    8,0   â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ SUMME (ausgewÃ¤hlt)  â”‚   143,0      â”‚    57,7     â”‚   66,1   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  Berechnung:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Basis: WandflÃ¤che (vorgeschlagen)          = 143,0 mÂ²      â”‚â”‚
â”‚  â”‚  Ã— Faktor: [1.00â–¼]                          = 143,0 mÂ²      â”‚â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚â”‚
â”‚  â”‚  MENGE: 143,0 mÂ²                                            â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  [â† Vorherige]  Position 1/12  [NÃ¤chste â†’]                      â”‚
â”‚                                                                 â”‚
â”‚  [â† ZurÃ¼ck: Positionen]                  [Weiter: Kalkulation â†’]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Spezial-Positionen:**
- **TÃ¼ren:** Default = Anzahl RÃ¤ume + 1 (EingangstÃ¼r)
- **Fensterlaibungen:** Manuell pro Raum
- **Q2 Ausbesserung:** WandflÃ¤che Ã— 0.25 (Slider 0.20-0.35)
- **Bad-Pauschalen:** RÃ¤ume mit "Bad" ausgeklammert

**Im PDF anzeigen:**
- Bei jeder Position: Welche RÃ¤ume, welche Dimension
- z.B. "143,0 mÂ² (Wohnzimmer, Schlafzimmer, KÃ¼che, Flur, Abstellraum - WandflÃ¤che)"

---

### Schritt 3: Kalkulation & Marge

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’° Kalkulation & Marge                             ATBS-472    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Preisprofil: [GWS Basis â–¼] + [Privataufschlag 15% â–¼]           â”‚
â”‚  [â˜] Profil fÃ¼r Kunde speichern                                 â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â–¼ Maler (4 Positionen)                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Position             â”‚   EK   â”‚   VK   â”‚ Marge  â”‚           â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ Raufaser tapezieren  â”‚  6,20â‚¬ â”‚  8,50â‚¬ â”‚  27%   â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ â”‚â”‚
â”‚  â”‚ Untergrund vorbereitenâ”‚ 2,40â‚¬ â”‚  3,20â‚¬ â”‚  25%   â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ â”‚â”‚
â”‚  â”‚ Q2 Ausbesserung      â”‚  3,50â‚¬ â”‚  4,80â‚¬ â”‚  27%   â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ â”‚â”‚
â”‚  â”‚ Streichen 2x         â”‚  4,80â‚¬ â”‚  6,40â‚¬ â”‚  25%   â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ Zwischensumme Maler  â”‚2.847 â‚¬ â”‚3.892 â‚¬ â”‚  27%   â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â–¶ Elektrik (8 Positionen)                    Marge: 22%        â”‚
â”‚  â–¶ SanitÃ¤r (6 Positionen)                     Marge: 24%        â”‚
â”‚  â–¶ Boden (4 Positionen)                       Marge: 28%        â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ZuschlÃ¤ge/AbschlÃ¤ge:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ [+ Zuschlag hinzufÃ¼gen]  [- Abschlag hinzufÃ¼gen]            â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ â˜‘ Baustelleneinrichtung (pauschal)      +  350,00 â‚¬         â”‚â”‚
â”‚  â”‚ â˜‘ Anfahrt (5 Fahrten)                   +  125,00 â‚¬         â”‚â”‚
â”‚  â”‚ â˜ Mengenrabatt > 10.000â‚¬                -    5,0 %          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  â”‚ Summe Netto:         12.847,00 â‚¬                            â”‚â”‚
â”‚  â”‚ + ZuschlÃ¤ge:            475,00 â‚¬                            â”‚â”‚
â”‚  â”‚ = Netto Gesamt:      13.322,00 â‚¬                            â”‚â”‚
â”‚  â”‚ + MwSt (19%):         2.531,18 â‚¬                            â”‚â”‚
â”‚  â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚â”‚
â”‚  â”‚ BRUTTO GESAMT:       15.853,18 â‚¬          Ã˜ Marge: 25,4%    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  Ziel-Marge: [25% â–¼]  Aktuell: 25,4% âœ…                         â”‚
â”‚                                                                 â”‚
â”‚  [â† ZurÃ¼ck: Mengen]                          [Weiter: Freigabe â†’]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Features:**
- EK/VK/Marge pro Position sichtbar
- Gewerke auf-/zuklappbar
- ZuschlÃ¤ge (pauschal oder %) hinzufÃ¼gen
- Kundenspezifische ZuschlÃ¤ge speichern (nicht im LV, nur im Kundenprofil)
- Ziel-Marge als Benchmark

---

### Schritt 4: Freigabe (4-Augen-Prinzip)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Freigabe                                        ATBS-472    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Angebot: ATBS-472-ANG01                                        â”‚
â”‚  Kunde: VBW Bauen und Wohnen GmbH                               â”‚
â”‚  Summe: 15.853,18 â‚¬ brutto (Marge: 25,4%)                       â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  [â˜‘] Vier-Augen-Freigabe aktivieren                             â”‚
â”‚                                                                 â”‚
â”‚  Freigeber: [Holger Neumann (GF) â–¼]                             â”‚
â”‚                                                                 â”‚
â”‚  Kommentar (optional):                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  [â† ZurÃ¼ck: Kalkulation]              [Zur Freigabe senden â†’]   â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Status: ENTWURF                                                â”‚
â”‚                                                                 â”‚
â”‚  Nach Freigabe verfÃ¼gbar:                                       â”‚
â”‚  â€¢ PDF generieren & speichern                                   â”‚
â”‚  â€¢ Per E-Mail an Kunde senden                                   â”‚
â”‚  â€¢ In AB/NUA umwandeln                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Schritt 5: Abschluss & Versand

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“„ Angebot abschlieÃŸen                             ATBS-472    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  âœ… Freigegeben von: Holger Neumann (30.01.2026, 16:45)         â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Dokumente:                                                     â”‚
â”‚                                                                 â”‚
â”‚  [âœ“] PDF generieren (Standard)                                  â”‚
â”‚  [â˜] Excel exportieren (On-Demand)                              â”‚
â”‚  [âœ“] JSON-Snapshot speichern (automatisch)                      â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  E-Mail an Kunde:                                               â”‚
â”‚                                                                 â”‚
â”‚  EmpfÃ¤nger: vbw-technik@vbw-bochum.de                           â”‚
â”‚  Betreff: Angebot ATBS-472-ANG01 | Bollwerkstr. 9               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Sehr geehrte Damen und Herren,                               â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ [KI-generierter Einleitungstext basierend auf Angebot]       â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ Die Komplettsanierung umfasst Maler-, Elektrik-, SanitÃ¤r-   â”‚â”‚
â”‚  â”‚ und Bodenarbeiten fÃ¼r eine 65 mÂ² Wohnung. Besonderer        â”‚â”‚
â”‚  â”‚ Fokus liegt auf der hochwertigen Q2-AusfÃ¼hrung...           â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ GÃ¼ltig bis: 28.02.2026                                       â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ Bei Fragen stehe ich Ihnen gerne zur VerfÃ¼gung.              â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ Mit freundlichen GrÃ¼ÃŸen                                      â”‚â”‚
â”‚  â”‚ Holger Neumann                                               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  Anhang: ATBS-472-ANG01.pdf                                     â”‚
â”‚                                                                 â”‚
â”‚  [ğŸ“¥ Nur speichern]        [ğŸ“§ Speichern & Senden]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Nummernlogik (Revisionssicher)

### Format

```
{ATBS}-{DOKUMENTTYP}{LAUFEND}

Beispiele:
- ATBS-472-ANG01  â†’ Angebot #1
- ATBS-472-ANG02  â†’ Angebot #2 (Revision)
- ATBS-472-AB01   â†’ AuftragsbestÃ¤tigung #1
- ATBS-472-NUA01  â†’ Nachunternehmer-Auftrag #1
- ATBS-472-RE01   â†’ Rechnung #1
```

### Dokumenttypen

| Typ | PrÃ¤fix | Beschreibung |
|-----|--------|--------------|
| Angebot | ANG | Kundenangebot mit Preisen |
| AuftragsbestÃ¤tigung | AB | Nach Auftragserteilung |
| Nachunternehmer-Auftrag | NUA | Ohne Preise, mit Budget |
| Rechnung | RE | Abrechnung |

### Revisions-Workflow

```
ANG01 (Entwurf)
  â†’ ANG01 (Freigegeben)
  â†’ Kunde will Ã„nderungen
  â†’ ANG02 (Entwurf, basiert auf ANG01)
  â†’ ANG02 (Freigegeben)
  â†’ Auftrag erteilt
  â†’ AB01 (aus ANG02 generiert)
  â†’ NUA01 (NU ausgewÃ¤hlt)
  â†’ RE01 (nach Fertigstellung)
```

---

## 5. Dokument-Workflow: ANG â†’ AB â†’ NUA â†’ RE

### 5.1 Angebot â†’ AuftragsbestÃ¤tigung

**Trigger:** Kunde erteilt Auftrag (basierend auf letztem Angebot)

**One-Click Konvertierung:**
```
[Auftrag erhalten â†’ AB erstellen]
```

**Ã„nderungen:**
- Titel: "AuftragsbestÃ¤tigung" statt "Angebot"
- Referenz: "Basierend auf Angebot ATBS-472-ANG02 vom 30.01.2026"
- Alles andere bleibt gleich

### 5.2 AuftragsbestÃ¤tigung â†’ NUA

**Trigger:** Nach AB wird Nachunternehmer ausgewÃ¤hlt

**Dialog: NU-Auswahl**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘· Nachunternehmer auswÃ¤hlen                       ATBS-472    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Gewerk: Maler                                                  â”‚
â”‚  Budget verfÃ¼gbar: 2.920 â‚¬ (75% von 3.892 â‚¬)                    â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Nachunternehmer    â”‚ Ã˜ Marge  â”‚ Letzte   â”‚ Historie 12 Mon. â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ Malerbetrieb MÃ¼llerâ”‚   28%    â”‚   26%    â”‚ â–ƒâ–…â–†â–…â–‡â–†â–…â–†â–‡â–…â–†â–‡    â”‚â”‚
â”‚  â”‚ Farbe & Co GmbH    â”‚   24%    â”‚   22%    â”‚ â–‚â–ƒâ–„â–ƒâ–„â–…â–„â–ƒâ–„â–…â–ƒâ–„    â”‚â”‚
â”‚  â”‚ ProMaler Dortmund  â”‚   22%    â”‚   25%    â”‚ â–„â–ƒâ–…â–†â–…â–„â–†â–…â–„â–…â–†â–…    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  AusgewÃ¤hlt: [Malerbetrieb MÃ¼ller â–¼]                            â”‚
â”‚                                                                 â”‚
â”‚  [NUA erstellen â†’]                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**NUA-Dokument enthÃ¤lt:**
- EmpfÃ¤nger: Nachunternehmer (nicht Kunde!)
- Positionen: Mit Langtexten, OHNE Preise
- Header-Infos:
  - Budget (gesamt)
  - Start-/Endtermin
  - Abschlagszahlung (ja/nein, HÃ¶he)
  - Ansprechpartner
- Footer: Vertragswerk (Kleingedrucktes)

### 5.3 PDF-Struktur: Angebot

```
Seite 1: Deckblatt
  - neurealis Logo
  - "Angebot"
  - Angebotsnummer, Datum
  - Kunde (Firma, Anschrift)
  - Projekt (ATBS, Adresse)

Seite 2-n: Positionen
  - Gruppiert nach Gewerk
  - Pro Position: Pos-Nr, Bezeichnung, Menge, Einheit, EP, GP
  - Raum-Info: "Wohnzimmer, Schlafzimmer (WandflÃ¤che)"
  - Zwischensummen pro Gewerk

Seite n+1: Zusammenfassung
  - Netto, MwSt, Brutto
  - GÃ¼ltigkeit
  - Zahlungsbedingungen

Seite n+2: Annahme-Formular
  - "Hiermit nehme ich das Angebot an"
  - Kunde als Absender vorausgefÃ¼llt
  - Unterschriftsfeld
  - Datum, Ort
```

---

## 6. AbhÃ¤ngigkeiten-System

### 6.1 Quellen fÃ¼r AbhÃ¤ngigkeiten

| Quelle | PrioritÃ¤t | Methode |
|--------|-----------|---------|
| LV-Langtexte (semantisch) | HOCH | KI-Analyse |
| Admin-Regeln (deterministisch) | HOCH | Manuell gepflegt |
| Kundenspezifische Regeln | MITTEL | Per Textfeld eingeben |
| Rechnungs-Training | NIEDRIG | Phase 3 |

### 6.2 LV-Langtext-Analyse

**Beispiel GWS-LV:**
```
Position: Unterverteilung aufrÃ¼sten
Artikelnummer: GWS.LV23-02.01.5
Langtext: "...inkl. ZÃ¤hlerschrank, Hauptsicherung, FI-Schutzschalter.
           Zulage fÃ¼r HeizkÃ¶rper bis 1,50m siehe Pos. 02.03.7..."
```

**KI erkennt:**
- Verweis auf andere Position (02.03.7)
- Keyword "Zulage" â†’ abhÃ¤ngige Position
- Gewerk-Kontext: Elektrik

**Ergebnis:**
```sql
INSERT INTO position_dependencies (source_artikelnummer, target_artikelnummer, type)
VALUES ('GWS.LV23-02.01.5', 'GWS.LV23-02.03.7', 'referenced_in_text');
```

### 6.3 Regel-Eingabe per Text

**UI:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“œ AbhÃ¤ngigkeiten verwalten                        GWS-LV      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Neue Regel eingeben (natÃ¼rliche Sprache):                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Wenn Raufaser tapezieren, dann immer Untergrund vorbereiten â”‚â”‚
â”‚  â”‚ und Q2 Ausbesserung 25% und Streichen 2x. Bei Decke auch    â”‚â”‚
â”‚  â”‚ DeckenflÃ¤che statt WandflÃ¤che nehmen.                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  [Regel analysieren]                                            â”‚
â”‚                                                                 â”‚
â”‚  Erkannte Regeln:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ âœ“ Raufaser â†’ Untergrund vorbereiten (immer)                 â”‚â”‚
â”‚  â”‚ âœ“ Raufaser â†’ Q2 Ausbesserung (Faktor: 0.25)                 â”‚â”‚
â”‚  â”‚ âœ“ Raufaser â†’ Streichen 2x (immer)                           â”‚â”‚
â”‚  â”‚ âœ“ Wenn OberflÃ¤che=Decke: DeckenflÃ¤che statt WandflÃ¤che      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  [Regeln speichern]                                             â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Bestehende Regeln:                                             â”‚
â”‚                                                                 â”‚
â”‚  â”‚ ID â”‚ Wenn...              â”‚ Dann...                â”‚ Aktion â”‚
â”‚  â”‚ 1  â”‚ Raufaser tapezieren  â”‚ Untergrund vorbereiten â”‚ [âœï¸][ğŸ—‘ï¸]â”‚
â”‚  â”‚ 2  â”‚ Raufaser tapezieren  â”‚ Q2 Ausbesserung (25%)  â”‚ [âœï¸][ğŸ—‘ï¸]â”‚
â”‚  â”‚ 3  â”‚ Raufaser tapezieren  â”‚ Streichen 2x           â”‚ [âœï¸][ğŸ—‘ï¸]â”‚
â”‚  â”‚ 4  â”‚ WE-TÃ¼r erneuern      â”‚ Zarge neu (Bedingung)  â”‚ [âœï¸][ğŸ—‘ï¸]â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.4 Kundenspezifische Regeln

**Speicherort:** Im Kundenprofil (kontakte)

**Beispiel VBW:**
```json
{
  "kunde_id": "vbw-bochum",
  "regeln": [
    {
      "wenn": "Elektrik komplett",
      "dann": ["E-Check Protokoll", "Rohinstallation Nachweis"],
      "typ": "required"
    },
    {
      "wenn": "Bad komplett",
      "dann": ["Abdichtungsprotokoll"],
      "typ": "required"
    }
  ],
  "standard_zuschlag": 0,
  "ziel_marge": 25
}
```

---

## 7. Datenmodell (Neue Tabellen)

### 7.1 angebote

```sql
CREATE TABLE angebote (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  angebot_nr TEXT UNIQUE NOT NULL,       -- ATBS-472-ANG01
  atbs_nummer TEXT NOT NULL,             -- ATBS-472
  projekt_id TEXT,                       -- monday_bauprozess.id
  kunde_id UUID,                         -- kontakte.id

  -- Struktur
  struktur TEXT DEFAULT 'gewerk',        -- 'gewerk' oder 'raum'
  lv_typ TEXT NOT NULL,                  -- GWS, VBW, neurealis, etc.

  -- Inhalte
  positionen JSONB NOT NULL,             -- Array von Positionen
  zuschlaege JSONB,                      -- Array von ZuschlÃ¤gen
  aufmass_ref UUID,                      -- aufmass_data.id

  -- BetrÃ¤ge
  summe_netto NUMERIC(12,2),
  summe_zuschlaege NUMERIC(12,2),
  summe_mwst NUMERIC(12,2),
  summe_brutto NUMERIC(12,2),
  durchschnitt_marge NUMERIC(5,2),

  -- Pricing
  pricing_profile_id UUID,
  kundenspezifische_aufschlaege JSONB,

  -- Status
  status TEXT DEFAULT 'entwurf',         -- entwurf, freigabe_angefordert, freigegeben, gesendet, angenommen, abgelehnt
  freigegeben_von UUID,
  freigegeben_am TIMESTAMPTZ,

  -- Dokumente
  pdf_path TEXT,                         -- Storage-Pfad
  json_snapshot JSONB,                   -- VollstÃ¤ndiger Snapshot

  -- Meta
  erstellt_von UUID,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Index fÃ¼r schnelle Suche
CREATE INDEX idx_angebote_atbs ON angebote(atbs_nummer);
CREATE INDEX idx_angebote_kunde ON angebote(kunde_id);
CREATE INDEX idx_angebote_status ON angebote(status);
```

### 7.2 angebots_positionen (Detail)

```sql
CREATE TABLE angebots_positionen (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  angebot_id UUID REFERENCES angebote(id) ON DELETE CASCADE,

  -- Position
  position_nr INTEGER NOT NULL,
  lv_position_id UUID,                   -- lv_positionen.id (kann NULL sein fÃ¼r freie Positionen)
  artikelnummer TEXT,
  bezeichnung TEXT NOT NULL,
  beschreibung TEXT,
  gewerk TEXT,

  -- Mengen
  menge NUMERIC(12,3),
  einheit TEXT,
  mengen_quelle JSONB,                   -- {"raeume": ["Wohnzimmer", "Schlafzimmer"], "typ": "wandflaeche", "faktor": 1.0}

  -- Preise
  einzelpreis_ek NUMERIC(12,2),
  einzelpreis_vk NUMERIC(12,2),
  gesamtpreis NUMERIC(12,2),
  marge_prozent NUMERIC(5,2),

  -- Flags
  ist_favorit BOOLEAN DEFAULT FALSE,
  ist_optional BOOLEAN DEFAULT FALSE,    -- Bedarfsposition
  ist_abhaengigkeit BOOLEAN DEFAULT FALSE,
  abhaengig_von UUID,                    -- Andere Position in diesem Angebot

  -- Sortierung
  sortierung INTEGER,

  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 7.3 position_dependencies (AbhÃ¤ngigkeiten)

```sql
CREATE TABLE position_dependencies (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

  -- Quelle und Ziel
  source_lv_position_id UUID,            -- lv_positionen.id
  source_artikelnummer TEXT,             -- Alternativ: Artikelnummer
  target_lv_position_id UUID,
  target_artikelnummer TEXT,

  -- Kontext
  lv_typ TEXT,                           -- GWS, VBW, etc. (NULL = alle)
  kunde_id UUID,                         -- Kundenspezifisch (NULL = global)

  -- Regel
  dependency_type TEXT NOT NULL,         -- 'required', 'suggested', 'referenced_in_text'
  condition JSONB,                       -- {"oberflÃ¤che": "wand", "q_standard": "Q2"}
  default_qty_factor NUMERIC(5,3),       -- z.B. 0.25 fÃ¼r "25% der FlÃ¤che"

  -- Herkunft
  source TEXT NOT NULL,                  -- 'admin_rule', 'text_analysis', 'customer_rule', 'learned'
  confidence NUMERIC(3,2),               -- 0.0-1.0 fÃ¼r gelernte Regeln

  -- Status
  is_active BOOLEAN DEFAULT TRUE,
  created_by UUID,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Indizes
CREATE INDEX idx_dependencies_source ON position_dependencies(source_artikelnummer);
CREATE INDEX idx_dependencies_lv_typ ON position_dependencies(lv_typ);
```

### 7.4 pricing_profiles

```sql
CREATE TABLE pricing_profiles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,                    -- "GWS Basis", "Privataufschlag 15%"

  -- Basis
  base_lv_typ TEXT,                      -- Welches LV als Basis

  -- Globaler Aufschlag
  markup_percent NUMERIC(5,2),           -- z.B. 15 fÃ¼r +15%

  -- Gewerk-spezifische AufschlÃ¤ge
  per_trade_overrides JSONB,             -- {"Elektrik": 20, "Maler": 10}

  -- Ziele
  target_margin NUMERIC(5,2),            -- Ziel-Marge

  -- Meta
  is_default BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Default-Profile
INSERT INTO pricing_profiles (name, base_lv_typ, markup_percent, target_margin, is_default) VALUES
  ('GWS Basis', 'GWS', 0, 25, TRUE),
  ('Privataufschlag 15%', 'GWS', 15, 30, FALSE),
  ('VBW Basis', 'VBW', 0, 22, FALSE),
  ('Covivio Basis', 'covivio', 0, 20, FALSE);
```

### 7.5 kunde_pricing (Kundenspezifisch)

```sql
CREATE TABLE kunde_pricing (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  kunde_id UUID REFERENCES kontakte(id),

  -- Standard-Profil fÃ¼r diesen Kunden
  default_profile_id UUID REFERENCES pricing_profiles(id),

  -- Individuelle AufschlÃ¤ge (Ã¼berschreiben Profil)
  custom_markup_percent NUMERIC(5,2),
  custom_trade_overrides JSONB,

  -- Ziel-Marge fÃ¼r diesen Kunden
  target_margin NUMERIC(5,2),

  -- Regeln
  custom_rules JSONB,                    -- Kundenspezifische AbhÃ¤ngigkeiten

  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 8. Edge Functions

### 8.1 transcription-parse

**Zweck:** Transkription/Spracheingabe â†’ strukturierte Positionen

**Input:**
```json
{
  "text": "Wohnzimmer WÃ¤nde Raufaser Q2 mit Streichen...",
  "lv_typ": "GWS",
  "atbs_nummer": "ATBS-472"
}
```

**Output:**
```json
{
  "gewerke": [
    {
      "name": "Maler",
      "positionen": [
        {
          "beschreibung_original": "Raufaser Q2 mit Streichen",
          "lv_position": {
            "id": "...",
            "artikelnummer": "GWS.LV23-05.01.1",
            "bezeichnung": "Raufaser tapezieren",
            "listenpreis": 8.50
          },
          "confidence": 0.92,
          "abhaengigkeiten": [
            {"artikelnummer": "GWS.LV23-05.02.1", "bezeichnung": "Untergrund vorbereiten"},
            {"artikelnummer": "GWS.LV23-05.03.1", "bezeichnung": "Q2 Ausbesserung", "faktor": 0.25},
            {"artikelnummer": "GWS.LV23-05.04.1", "bezeichnung": "Streichen 2x"}
          ]
        }
      ]
    }
  ]
}
```

### 8.2 analyze-lv-dependencies

**Zweck:** LV-Langtexte analysieren â†’ AbhÃ¤ngigkeiten erkennen

**Trigger:** Manuell oder bei LV-Import

**Prozess:**
1. Alle Positionen eines LV-Typs laden
2. Langtexte mit GPT-5.2 analysieren
3. Verweise auf andere Positionen erkennen
4. Keyword-Analyse (Zulage, inkl., siehe Pos., etc.)
5. Ergebnisse in `position_dependencies` speichern

### 8.3 angebot-generate-pdf

**Zweck:** Angebot als PDF generieren

**Nutzt:** jsPDF + autotable (wie LV-Export)

**Template-Struktur:**
- Deckblatt mit Logo
- Positionen nach Gewerk gruppiert
- Raum-Info bei Mengen
- Zusammenfassung
- Annahme-Formular (letzte Seite)

---

## 9. Implementierungs-Reihenfolge

### Phase 1: MVP (2-3 Wochen)

| Nr | Task | Prio | AbhÃ¤ngigkeit |
|----|------|------|--------------|
| T1 | DB-Migrationen (angebote, positionen, dependencies, pricing) | HOCH | - |
| T2 | Position-Dependencies: Admin-Regeln UI | HOCH | T1 |
| T3 | LV-Langtext-Analyse Edge Function | HOCH | T1 |
| T4 | Wizard Schritt 0+1: Projekt + Positionen | HOCH | T1, T2 |
| T5 | Wizard Schritt 2: Mengen (AufmaÃŸ-Integration) | HOCH | T4 |
| T6 | Wizard Schritt 3: Kalkulation | HOCH | T5 |
| T7 | Wizard Schritt 4+5: Freigabe + Versand | MITTEL | T6 |
| T8 | PDF-Generierung (angepasst von LV-Export) | MITTEL | T6 |
| T9 | E-Mail-Versand (Graph API) | NIEDRIG | T7, T8 |

### Phase 2: Erweiterungen

| Nr | Task |
|----|------|
| T10 | Raum-basierte Struktur |
| T11 | Kundenspezifisches Regeltraining per Text |
| T12 | AB/NUA-Generierung |
| T13 | NU-Auswahl mit Margen-Historie |

### Phase 3: Lernen

| Nr | Task |
|----|------|
| T14 | Rechnungs-Import (Excel) |
| T15 | Association Rules Training |
| T16 | GAEB Import/Export |

---

## 10. Offene Fragen

1. **AufmaÃŸ-Geometrie:** Welche Formen auÃŸer rechteckig werden unterstÃ¼tzt? (L-Form, SchrÃ¤gen)
2. **Annahme-Formular:** Exaktes Layout/Text fÃ¼r die Annahme-Seite?
3. **NUA-Vertragswerk:** Welcher Text soll im Kleingedruckten stehen?
4. **Bedarfspositionen:** Welche Standard-Positionen sollen immer als optional angeboten werden?

---

*Dokument erstellt: 2026-01-30*
*Letzte Aktualisierung: 2026-01-30*
